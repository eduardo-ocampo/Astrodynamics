# Clohessy-Wiltshire Equations

TODO: Add some intro

Now, consider the dimensional Hill's Equations of motion {eq}`hills_eom_dimen` to describe the motion of a spacecraft relative to another spacecraft. Start by switching the body notation of {eq}`hills_eom_dimen` such that Earth is in place of the Sun $P_1$, and the two spacecraft take the place of $P_0$ and $P_N$.

ADD Figure here similar to slide 7. add notes under particles P0,Sc PN,S1

Since the central spacecraft body is inplace of Earth $\mu_E \rightarrow 0$. All this together gives rise to the Clohessy-Wilthsire Equations or sometimes referred to the Rendevezvous Equations since they describe the relative motion of two spacecraft:

:::{math}
:label: cw_eoms
\begin{align*}
\ddot{x} - 2n \dot{y} &= 3n^2 x \\
\ddot{y} + 2n \dot{x} &= 0 \\
\ddot{z}              &= - n^2 z
\end{align*}
:::

The usefulness of {eq}`cw_eoms` is that they have a closed form solution. They can be integrated analyticall. Note that this is an approximation becuase they come from truncating the Legendre polynomials {eq}`rk_poly_applied`.

The solution to the Clohessy-Wiltshire Equations of motion {eq}`cw_eoms` has the form:

:::{math}
:label: cw_sol_constants
\begin{align*}
x\left( t \right) &= C_1 \cos{nt} + C_2 \sin{nt} + C_3 \\
y\left( t \right) &= 2 C_2 \cos{nt} - 2 C_2 \sin{nt} - \frac{3}{2} C_3 nt + C_4 \\
z\left( t \right) &= C_5 \cos{nt} + C_6 \sin{nt}
\end{align*}
:::

Solving for constants, the general soltuion to the Clohessy-Wiltshire Equations yields:

:::{math}
:label: cw_sol_general
\begin{align*}
x\left( t \right) &= \left[ 4-3\cos{nt}\right]x_0 + \frac{\dot{x}_0\sin{nt}}{n} + \frac{2}{n}\left( 1 - \cos{nt} \right) \dot{y}_0 \\
y\left( t \right) &= 6\left[ \sin{nt} - nt \right]x_0 + y_0 + \frac{2}{n}\left[ \cos{nt} - 1 \right]\dot{x}_0 + \frac{1}{n} \left[ 4\sin{nt} -3nt\right]\dot{y}_0 \\
z\left( t \right) &= z_0 \cos{nt} + \frac{\dot{z}_0}{n} \sin{nt}
\end{align*}
:::

where the initial state vector representes the initial postion and velocity in the rotating coordinate frome of spacecraft $S_1$ with respect to the central spacecraft $S_c$.



Taking the derivative of {eq}`cw_sol_general` the Clohessy-Wiltshire Equaitons can be put into a matrix form:

:::{math}
:label: cw_matrix

\begin{bmatrix}
\mathbf{r} \\
\mathbf{v}
\end{bmatrix}
=
\begin{bmatrix}
\mathbf{A} & \mathbf{B} \\
\mathbf{C} & \mathbf{D}
\end{bmatrix}
=
\begin{bmatrix}
\mathbf{r}_0 \\
\mathbf{v}_0
\end{bmatrix}
:::

## Python Examples of PlanarCW Equations


1. Motion of a neighboring circuar orbit

Consider the central spacecraft $S_c$ and neighboring spacecrafts $S_1$ and $S_2$. 

Draw figure

Using the Clohessy-Wiltshire Equaitons {eq}`cw_matrix` we can described the relative motion of $S_1$ and $S_2$ with respect to $S_c$ given the general initial state for $S_2$ and $S_2$:

:::{math}

\mathbf{x}_0 = 
\begin{bmatrix}
x_0 \\
0   \\
y_0 \\
-\frac{3}{2} n x_0
\end{bmatrix}
:::

the analytical soluiton to this problem is:

:::{math}
\begin{align*}
x\left(t\right) &= x_0 \\
y\left(t\right) &= y_0 - \frac{3}{2} nt x_0
\end{align*}
:::



Using python scripts...

show steps

then create plot

Notice how the spacecraft 1 & 2 move in opposite directions relative to the central spacecarft $S_c$. Spacecraft 1 is moving faster hence it moves upwards. Whereas spacecraft 2 has a larger orbital period and regresses relative to $S_c$. 

2. Motion of an elliptical orbit with the same period

Consider a central spacecraft $S_c$ in the rotating coordinate frame such that is in a circular orbit and a neighboring spacecarft $S_1$ in an elliptical orbit with the same period $P$. 

Draw figure.

Using the Clohessy-Wiltshire Equaitons {eq}`cw_matrix` we can described the relative motion of $S_1$ with respect to $S_c$ given an initial state vector:

:::{math}
\mathbf{x}_0 = 
\begin{bmatrix}
x_0 \\
0   \\
y_0 \\
-2 n x_0
\end{bmatrix}
:::

:::{math}
\begin{align*}
x\left(t\right) &= x_0 \cos{nt}\\
y\left(t\right) &= y_0 - {2}\sin{nt}
\end{align*}
:::

Assume y0=0, solve plot the motion of $S_1$ in the rotating coordiante frame. Using Python scripts

show steps

create plots. note 4xo, 2xo, apopaiss, perapossi. see if y0=0 centers motion at the origin and then try anohter y0.

Figure XXX shows that spacecraft $S_1$ moves in an elliptical motion aroudn the $S_c$.

Consider what if they don't have the same period?

3. Delta V Along the y-axis

Consider the what will happen if some deltaV is applied along the y-axis in the rotating coordinate frame. Let's assume the central spaccraft is teh International Space Station $S_c$ and spacecraft 1 $S_1$ is a docked Crew Dragon capsule. What would happend if Crew Dragon undocks with a deltaV applied int the + y-axis direction?

Draw Figure Rotating Frame

Assume the following initial state:

:::{math}
\mathbf{x}_0 = 
\begin{bmatrix}
0 \\
0 \\
0 \\
\dot{y}_0
\end{bmatrix}
:::

where $\dot{y} \gt 0$.


Then the analytical soluiton to the Planar CW equations is:

:::{math}
\begin{align*}
x\left(t\right) &= \frac{2}{n}\left[ 1 - \cos{nt} \right] \dot{y}_0 \\
y\left(t\right) &= \frac{1}{n}\left[ 4\sin{nt} - 3nt  \right] \dot{y}_0
\end{align*}
:::

From inspecton $x\left( t \right)$ is sinusoidal whereas $y\left( t \right)$ has both a sinusoidal and a negative secular effect. We should expect that over time $y\left( t \right)$ would grow more and more negative given $\dot{y} \gt 0$. 

Solve using Python

show steps 

add figure

As predicted, due to $\dot{y} \gt 0$ the spacecraft is moving away from the Interinal Space Station. Relative to the ISS Crew Dragon gained delta V in the +y-direciton meaning it's period is larger and takes longer to come back. Over time it looks like Crew Dragon is moving behind ISS in the rotating coordinate frame. 

Now if Crew Dragon applies a delta V in the opposite direction at time $t_0$ we should expect the opposite behavouir.

4. Delta V Along the x-axis

Consider the same initial setup of Crew Dragon undocking from the International Space Station as [Delta V along y-axis](4.). Now what would happend if Crew Dragon undocks with a deltaV applied in the radial direciton (+x-axis)?

Draw Rotating Frame Figure

Assume the following initial state:

:::{math}
\mathbf{x}_0 = 
\begin{bmatrix}
0 \\
0 \\
\dot{x}_0 \\
0 
\end{bmatrix}
:::

where $\dot{x} \gt 0$.


Then the analytical soluiton to the Planar CW equations is:

:::{math}
\begin{align*}
x\left(t\right) &= \frac{1}{2}\sin{nt}\dot{x}_0 \\
y\left(t\right) &= \frac{2}{n}\left[ \cos{nt}-1 \right]\dot{x}_0
\end{align*}
:::

Let's inspec the analytical soluiton. For this case both $x\left( t \right)$ and $y\left( t \right)$ are sinosidoal. Meaning the relative motion of Crew Dragon will appear to be circular/ellipitcal.

Solve using Python

show steps 

add figure

Figure XXX shows that if Crew Dragon was to apply a delta V in the +x-axis the spacecraft will come back to the origin! This may not be ideal, be careful when throwing a ball from the Interiaal Space Station as the object may come back to hit your spacecraft. But remember that the CW equations are an approximation.

## Python Rendezvous Example

Consider a rendezous problem such that $S_1$ is the chaser and $S_2$ is the target. Given an initial state vector $\mathbf{r}_0$ and the final state $\mathbf{r} = 0$ for a rendezvous we can determine rought what inital del V is required to reach the target and the final del V to apply to stay in relative motion with the target and dock.

given ro find vo

r = Aro + Bvo
vo = -(Aro)/B

now final vf

v = Cro + Dvo